<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluación Ciberseguridad</title>
    <style>
        :root {
            --primary: #2563eb;
            --success: #16a34a;
            --bg: #f8fafc;
            --border: #e2e8f0;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg);
            color: #1e293b;
            margin: 0;
            padding: 20px;
            line-height: 1.5;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }

        h1 {
            text-align: center;
            color: var(--primary);
            margin-bottom: 30px;
        }

        /* Selector de Grupo */
        .control-panel {
            background: #eff6ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            border: 1px solid #bfdbfe;
        }

        select {
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 6px;
            border: 1px solid #cbd5e1;
            cursor: pointer;
        }

        /* Tabla Rúbrica */
        .rubrica-section {
            margin-bottom: 40px;
        }
        
        .section-title {
            background: #f1f5f9;
            padding: 10px 15px;
            border-left: 5px solid var(--primary);
            margin-bottom: 15px;
            font-weight: bold;
            font-size: 1.1em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th {
            background: #f8fafc;
            padding: 12px;
            text-align: center;
            border-bottom: 2px solid var(--border);
            color: #64748b;
            font-weight: 600;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        .col-criterio { width: 20%; font-weight: 600; }
        .col-desc { width: 30%; font-size: 0.9em; color: #475569; }
        
        /* Celdas de puntuación */
        .score-cell {
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            width: 10%;
            font-weight: bold;
            color: #94a3b8;
        }

        .score-cell:hover {
            background-color: #f0f9ff;
        }

        /* Estilo cuando está seleccionado */
        .selected {
            background-color: var(--primary) !important;
            color: white !important;
            transform: scale(1.05);
            box-shadow: 0 2px 4px rgb(0 0 0 / 0.1);
            border-radius: 6px;
        }

        /* Botón Guardar */
        .btn-save {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: var(--success);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-save:hover {
            background-color: #15803d;
        }

        .btn-save:disabled {
            background-color: #cbd5e1;
            cursor: not-allowed;
        }

        /* Mensajes */
        #statusMessage {
            text-align: center;
            margin-top: 15px;
            font-weight: bold;
            min-height: 24px;
        }

        .header-scores th {
            font-size: 0.8em;
            text-transform: uppercase;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Evaluación de Ciberseguridad</h1>

    <!-- Panel de Selección -->
    <div class="control-panel">
        <label for="grupoSelect"><strong>Seleccionar Grupo:</strong></label>
        <select id="grupoSelect">
            <option value="" disabled selected>-- Elige un grupo --</option>
            <option value="GRUPO1">GRUPO 1</option>
            <option value="GRUPO2">GRUPO 2</option>
            <option value="GRUPO3">GRUPO 3</option>
            <option value="GRUPO4">GRUPO 4</option>
            <option value="GRUPO5">GRUPO 5</option>
            <option value="GRUPO6">GRUPO 6</option>
        </select>
    </div>

    <!-- RÚBRICA 1: TRABAJO ESCRITO (Filas 2, 3, 4 en Excel) -->
    <div class="rubrica-section">
        <div class="section-title">PARTE 1: TRABAJO ESCRITO</div>
        <table>
            <thead>
                <tr class="header-scores">
                    <th class="col-criterio">Criterio</th>
                    <th class="col-desc">Descripción</th>
                    <th>1<br><small>Muy Mal</small></th>
                    <th>2<br><small>Mal</small></th>
                    <th>3<br><small>Regular</small></th>
                    <th>4<br><small>Bien</small></th>
                    <th>5<br><small>Muy Bien</small></th>
                </tr>
            </thead>
            <tbody>
                <!-- ÍTEM 1 (Fila 2) -->
                <tr class="fila-evaluacion" data-index="0">
                    <td>Dominio del Tema</td>
                    <td class="col-desc">Demuestra un entendimiento completo y profundo de todos los conceptos asignados, usando la terminología correcta</td>
                    <td class="score-cell" onclick="selectScore(0, 1)">1</td>
                    <td class="score-cell" onclick="selectScore(0, 2)">2</td>
                    <td class="score-cell" onclick="selectScore(0, 3)">3</td>
                    <td class="score-cell" onclick="selectScore(0, 4)">4</td>
                    <td class="score-cell" onclick="selectScore(0, 5)">5</td>
                </tr>
                <!-- ÍTEM 2 (Fila 3) -->
                <tr class="fila-evaluacion" data-index="1">
                    <td>Investigación y Uso de Fuentes</td>
                    <td class="col-desc">Integra de forma eficaz la web de la asignatura y los recursos externos recomendados para enriquecer el análisis.</td>
                    <td class="score-cell" onclick="selectScore(1, 1)">1</td>
                    <td class="score-cell" onclick="selectScore(1, 2)">2</td>
                    <td class="score-cell" onclick="selectScore(1, 3)">3</td>
                    <td class="score-cell" onclick="selectScore(1, 4)">4</td>
                    <td class="score-cell" onclick="selectScore(1, 5)">5</td>
                </tr>
                <!-- ÍTEM 3 (Fila 4) -->
                <tr class="fila-evaluacion" data-index="2">
                    <td>Análisis del Caso Real</td>
                    <td class="col-desc">El caso es relevante, está bien explicado y se conecta de forma crítica con la teoría, demostrando comprensión. (Este es un requisito esencial y debe ocupar el 30% del tiempo de preparación)</td>
                    <td class="score-cell" onclick="selectScore(2, 1)">1</td>
                    <td class="score-cell" onclick="selectScore(2, 2)">2</td>
                    <td class="score-cell" onclick="selectScore(2, 3)">3</td>
                    <td class="score-cell" onclick="selectScore(2, 4)">4</td>
                    <td class="score-cell" onclick="selectScore(2, 5)">5</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- RÚBRICA 2: EXPOSICIÓN (Filas 7, 8, 9 en Excel) -->
    <div class="rubrica-section">
        <div class="section-title">PARTE 2: EXPOSICIÓN ORAL</div>
        <table>
            <thead>
                <tr class="header-scores">
                    <th class="col-criterio">Criterio</th>
                    <th class="col-desc">Descripción</th>
                    <th>1</th><th>2</th><th>3</th><th>4</th><th>5</th>
                </tr>
            </thead>
            <tbody>
                <!-- ÍTEM 4 (Fila 7) -->
                <tr class="fila-evaluacion" data-index="3">
                    <td>Claridad y Estructura</td>
                    <td class="col-desc">La exposición es lógica, clara y fácil de seguir para la audiencia, sin divagaciones</td>
                    <td class="score-cell" onclick="selectScore(3, 1)">1</td>
                    <td class="score-cell" onclick="selectScore(3, 2)">2</td>
                    <td class="score-cell" onclick="selectScore(3, 3)">3</td>
                    <td class="score-cell" onclick="selectScore(3, 4)">4</td>
                    <td class="score-cell" onclick="selectScore(3, 5)">5</td>
                </tr>
                <!-- ÍTEM 5 (Fila 8) -->
                <tr class="fila-evaluacion" data-index="4">
                    <td>Comunicación Oral</td>
                    <td class="col-desc">El equipo se expresa con fluidez y confianza. El tiempo está bien distribuido (máximo 10 minutos) y todos los miembros participan (la participación es obligatoria)</td>
                    <td class="score-cell" onclick="selectScore(4, 1)">1</td>
                    <td class="score-cell" onclick="selectScore(4, 2)">2</td>
                    <td class="score-cell" onclick="selectScore(4, 3)">3</td>
                    <td class="score-cell" onclick="selectScore(4, 4)">4</td>
                    <td class="score-cell" onclick="selectScore(4, 5)">5</td>
                </tr>
                <!-- ÍTEM 6 (Fila 9) -->
                <tr class="fila-evaluacion" data-index="5">
                    <td>Recursos Visuales</td>
                    <td class="col-desc">El material de apoyo (diapositivas, etc.) es visualmente atractivo, claro y refuerza el mensaje en lugar de distraer</td>
                    <td class="score-cell" onclick="selectScore(5, 1)">1</td>
                    <td class="score-cell" onclick="selectScore(5, 2)">2</td>
                    <td class="score-cell" onclick="selectScore(5, 3)">3</td>
                    <td class="score-cell" onclick="selectScore(5, 4)">4</td>
                    <td class="score-cell" onclick="selectScore(5, 5)">5</td>
                </tr>
            </tbody>
        </table>
    </div>

    <button id="btnGuardar" class="btn-save" onclick="enviarDatos()">Guardar Evaluación</button>
    <div id="statusMessage"></div>

</div>

<script>
    // ==========================================
    // CONFIGURACIÓN
    // ==========================================
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzyt6r-q8LHJWOth130LUVx4uXN8t6Jje9hGnNhXXDsqpYePZ5wXjtYMZk9rqVovlqE/exec"; 
    
    // Estado de la aplicación: Almacena las 6 notas (inicializadas a null)
    // Índices 0-2: Rúbrica 1. Índices 3-5: Rúbrica 2.
    let valoraciones = [null, null, null, null, null, null];

    /**
     * Función que se ejecuta al hacer clic en una celda de puntuación
     * @param {number} filaIndex - Índice de la fila (0 a 5)
     * @param {number} valor - Puntuación seleccionada (1 a 5)
     */
    function selectScore(filaIndex, valor) {
        // 1. Guardar el valor en el array
        valoraciones[filaIndex] = valor;

        // 2. Actualizar la interfaz visual
        // Buscamos todas las celdas de esa fila específica
        const fila = document.querySelector(`tr[data-index="${filaIndex}"]`);
        const celdas = fila.querySelectorAll('.score-cell');

        // Quitamos la clase 'selected' de todas
        celdas.forEach(c => c.classList.remove('selected'));

        // Añadimos 'selected' a la celda clicada (la celda con valor - 1 es el índice)
        celdas[valor - 1].classList.add('selected');
    }

    /**
     * Función para enviar los datos a Google Sheets
     */
    function enviarDatos() {
        const grupo = document.getElementById('grupoSelect').value;
        const btn = document.getElementById('btnGuardar');
        const msg = document.getElementById('statusMessage');

        // Validaciones
        if (!grupo) {
            msg.textContent = "⚠️ Por favor, selecciona un grupo.";
            msg.style.color = "red";
            return;
        }

        if (valoraciones.includes(null)) {
            msg.textContent = "⚠️ Debes evaluar todos los criterios antes de guardar.";
            msg.style.color = "red";
            return;
        }

        // Preparar envío
        btn.disabled = true;
        btn.textContent = "Guardando...";
        msg.textContent = "";

        // Enviar Petición
        fetch(SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors', // Importante para Google Apps Script
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                grupo: grupo,
                valoraciones: valoraciones
            })
        })
        .then(() => {
            // Como usamos no-cors, asumimos éxito si no hay error de red
            msg.textContent = "✅ ¡Guardado con éxito en " + grupo + "!";
            msg.style.color = "green";
            
            // Reiniciar formulario opcionalmente
            setTimeout(() => {
                btn.disabled = false;
                btn.textContent = "Guardar Evaluación";
                // Limpiar selección visual si quisieras evaluar otro grupo inmediatamente
                // limpiarFormulario(); 
            }, 2000);
        })
        .catch(error => {
            console.error('Error:', error);
            msg.textContent = "❌ Error al conectar con el servidor.";
            msg.style.color = "red";
            btn.disabled = false;
            btn.textContent = "Reintentar";
        });
    }
</script>

</body>
</html>